<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
  <head>
    <title>SRFI 19: Time Data Types and Procedures</title>
<META content="text/html; charset=windows-1252" http-equiv=Content-Type>
<META content="MSHTML 5.00.2014.210" name=GENERATOR>
  </head>

<body>
<H1>Title</H1>

Time Data Types and Procedures

<H1>Author</H1>

Will Fitzgerald, Neodesic Corporation

<H1>Status</H1>

This SRFI is currently in ``draft'' status. To see an explanation of
each status that a SRFI can hold, see <a
href="http://srfi.schemers.org/srfi-process.html">here</a>. It will
remain in draft status until 2000/05/28, or as amended. To provide
input on this SRFI, please <a
href="mailto:srfi-19@srfi.schemers.org">mail to
srfi-19@srfi.schemers.org</a>.  See <a
href="http://srfi.schemers.org/srfi-list-subscribe.html">instructions
here</a> to subscribe to the list.  You can access previous messages
via <a
href="http://srfi.schemers.org/srfi-19/mail-archive/maillist.html">
the archive of the mailing list</a>.
<P>
<UL>
<LI>Draft: 2000/02/28-2000/05/28 </LI>
</UL>

<H1>Abstract</H1>

A point in time can be described by either a single (real) number of
seconds, or as a complex object. The 'number of seconds' view on time
has the advantage of being usable as any other number. The 'complex
object' view has the advantage of mapping more closely to standard
notions of time components, such as year, day, hour, etc. Accessor
procedures are provided for the time object, as well as converters
between time and seconds, and time and ISO standard time
strings. Procedures for 'time arithmetic' and time comparisons are also defined.



<H1>Issues</H1>[None currently]


<H1>Rationale</H1>

R5RS Scheme does not provide standard data types for time. This
SRFI addresses this lack by specifying two data types for time and
associated procedures.


<H1>Specification</H1>

<p><b>Time</b> defines a point in time as consisting of seven components:
<ul>
<li><b>Second</b>, a real (potentially inexact) between 0 and 61,
inclusive, (seconds greater than 59 are for describing rare leap seconds)
<li><b>Minute</b>, an integer between 0 and 59, inclusive,
<li><b>Hour</b>, an integer between 0 and 23, inclusive,
<li><b>Day</b>, an integer between 0 and 31, inclusive, the upper limit depending
on the month and year of the point in time,
<li><b>Month</b>, an integer between 1 and 12, inclusive; in which 1 means
January, 2 February, and so on.
<li><b>Year</b>, an integer representing the year.
<li><b>Time zone</b>, a integer the number of seconds east of GMT for this timezone.


</ul>

<p><b>Seconds</b> represents time as a single real number, potentially
inexact, corresponding to the number of seconds from 0 to
implementation specific upper range, with the meaning of 0
implementation specific.


<P>The following procedures are required: 
<DL>
  <DT class=proc-def><CODE class=proc-def>current-time</CODE> <VAR>-&gt; 
  time</VAR> 
  <DD class=proc-def>Returns the current time as a time object. 

  <DT call="proc-def"><CODE class=proc-def>current-seconds</CODE> <VAR>-&gt; 
  real</VAR> 
  <DD class=proc-def>Returns the current time in seconds. 
  <DT class=proc-def><CODE class=proc-def>make-time</CODE> 
  <VAR>second minute hour date month year zone-offset -&gt;time </VAR> 
  <DD class=proc-def>Creates a time object from time components.

  <DT class=proc-def><CODE class=proc-def>time-second</CODE> 
  <VAR>time -&gt; real (0 to 61.0) </VAR>
  <DD class=proc-def>Seconds component of time object. Potentially
  includes leap seconds.

  <DT class=proc-def><CODE class=proc-def>time-minute</CODE> 
  <VAR>time -&gt; integer (0 to 59) </VAR>
  <DD class=proc-def>Minute component of time object.

  <DT class=proc-def><CODE class=proc-def>time-hour</CODE> 
  <VAR>time -&gt; integer (0 to 23) </VAR>
  <DD class=proc-def>Hour component of time object.

  <DT class=proc-def><CODE class=proc-def>time-day</CODE> 
  <VAR>time -&gt; integer (1 to 31) </VAR>
  <DD class=proc-def>Day component of time object.

  <DT class=proc-def><CODE class=proc-def>time-month</CODE> 
  <VAR>time -&gt; integer (1 to 12) </VAR>
  <DD class=proc-def>Month component of time object, where January=1,
  February=2, etc.

  <DT class=proc-def><CODE class=proc-def>time-year</CODE> 
  <VAR>time -&gt; integer</VAR>
  <DD class=proc-def>Year component of time object. May not be equal
  to 0.

  <DT class=proc-def><CODE class=proc-def>time-zone-offset</CODE> 
  <VAR>time -&gt; integer</VAR>
  <DD class=proc-def>Time zone offset for time object, the number of
  seconds east of GMT for this time zone.

  <DT class=proc-def><CODE class=proc-def>time-year-day</CODE> 
  <VAR>time -&gt; integer (between 0 and 365)</VAR>
  <DD class=proc-def>Returns the day of the year of this time object,
  where 0 = January 1, etc. Maximum of 364 in non-leap years.

  <DT class=proc-def><CODE class=proc-def>time-week-day</CODE> 
  <VAR>time -&gt; integer (between 0 and 6)</VAR>
  <DD class=proc-def>Returns the day of the week of this time object,
  where 0 = Sunday, 1 = Monday, etc.

  <DT class=proc-def><CODE class=proc-def>julian-day</CODE> 
  <VAR>time -&gt; real</VAR>
  <DD class=proc-def>Returns the Julian Day of the time object, where 
  Julian Day 0 designates the 24 hours from noon UTC on 1 January 4713 BC
 to noon UTC on 2 January 4713 BC. 

  <DT class=proc-def><CODE class=proc-def>modified-julian-day</CODE> 
  <VAR>time -&gt; real</VAR>
  <DD class=proc-def>Returns the Modified Julian Day of the time
  object, that is, the number of days since 17 Nov 1858 at 00:00:00 UTC.

  <DT class=proc-def><CODE class=proc-def>set-time-second!</CODE> 
  <VAR>time real (0 to 61.0) </VAR>
  <DD class=proc-def>Sets the Seconds component of time object. Potentially
  includes leap seconds.

  <DT class=proc-def><CODE class=proc-def>set-time-minute!</CODE> 
  <VAR>time integer (0 to 59) </VAR>
  <DD class=proc-def>Sets the Minute component of time object.

  <DT class=proc-def><CODE class=proc-def>set-time-hour!</CODE> 
  <VAR>time integer (0 to 23) </VAR>
  <DD class=proc-def>Sets the Hour component of time object.

  <DT class=proc-def><CODE class=proc-def>set-time-day!</CODE> 
  <VAR>time integer (1 to 31) </VAR>
  <DD class=proc-def>Sets the Day component of time object.

  <DT class=proc-def><CODE class=proc-def>set-time-month!</CODE> 
  <VAR>time integer (1 to 12) </VAR>
  <DD class=proc-def>Sets the Month component of time object, where January=1,
  February=2, etc.

  <DT class=proc-def><CODE class=proc-def>set-time-year!</CODE> 
  <VAR>time integer</VAR>
  <DD class=proc-def>Sets the Year component of time object. May not be equal
  to 0.

  <DT class=proc-def><CODE class=proc-def>set-time-zone-offset!</CODE> 
  <VAR>time integer</VAR>
  <DD class=proc-def>Sets the Time zone offset for time object, the number of
  seconds east of GMT for this time zone.

  <DT class=proc-def><CODE class=proc-def>copy-time</CODE> 
  <VAR>time -&gt; time</VAR>
  <DD class=proc-def>Copies a time object, creating a new object.

  <DT class=proc-def><CODE class=proc-def>time-&gt;seconds</CODE> 
  <VAR>time -&gt; real</VAR>
  <DD class=proc-def>Converts a time object to seconds with
  implementation-specific range. Returns #f if unable to convert.

  <DT class=proc-def><CODE class=proc-def>seconds-&gt;time</CODE> 
  <VAR>real -&gt; time</VAR>
  <DD class=proc-def>Converts a number of seconds into a time object.

  <DT class=proc-def><CODE class=proc-def>julian-day&gt;time</CODE> 
  <VAR>real -&gt; time</VAR>
  <DD class=proc-def>Converts a Julian Day into a time object.

  <DT class=proc-def><CODE class=proc-def>modified-julian-day-&gt;time</CODE> 
  <VAR>real -&gt; time</VAR>
  <DD class=proc-def>Converts a Modified Julian Day into a time object.

  <DT class=proc-def><CODE class=proc-def>time-&gt;universal-time!</CODE> 
  <VAR>time -&gt; time</VAR>
  <DD class=proc-def>Adds (subtracts) enough seconds to the time
  object to set the time zone offset to 0. Sets the time zone offset
  to 0, too.

  <DT class=proc-def><CODE class=proc-def>time-&gt;universal-time</CODE> 
  <VAR>time -&gt; time</VAR>
  <DD class=proc-def>Creates a copy of the time object, and adds
  (subtracts) enough seconds to the time object to set the time zone
  offset to 0. Sets the time zone offset  to 0, too.

  <DT class=proc-def><CODE class=proc-def>time-&gt;string</CODE> 
  <VAR>time [include-time-zone-offset?] -&gt; string</VAR>
  <DD class=proc-def>Converts the time object to a ISO time string,
  including the time zone offset unless
  <var>include-time-zone-offset?</var> is #f.

  <DT class=proc-def><CODE class=proc-def>time-&gt;date-string</CODE> 
  <VAR>time -&gt; string</VAR>
  <DD class=proc-def>Converts the time object to a ISO time string,
  including just the date portions of the time object (year, month,
  day). For example, "2000-4-11".

  <DT class=proc-def><CODE class=proc-def>time-&gt;hour-string</CODE> 
  <VAR>time -&gt; string</VAR>
  <DD class=proc-def>Converts the time object to a ISO time string,
  including just the hour portions of the time object (hour, minute,
  second). For example, "22:42:45.3".

  <DT class=proc-def><CODE class=proc-def>time?</CODE> 
  <VAR>object -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if object is a time object, #f otherwise.

  <DT class=proc-def><CODE class=proc-def>time=?</CODE> 
  <VAR>time1 time2 -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if two times are the same point in
  time, #f otherwise. Must account for time zone offsets. 

  <DT class=proc-def><CODE class=proc-def>time&gt;?</CODE> 
  <VAR>time1 time2 -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if time1 is after time2, #f
  otherwise. Must account for time zone offsets.

  <DT class=proc-def><CODE class=proc-def>time&lt;?</CODE> 
  <VAR>time1 time2 -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if time1 is before time2, #f
  otherwise. Must account for time zone offsets.

  <DT class=proc-def><CODE class=proc-def>time&gt;=?</CODE> 
  <VAR>time1 time2 -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if time1 is at or after time2, #f
  otherwise. Must account for time zone offsets.

  <DT class=proc-def><CODE class=proc-def>time&lt;=?</CODE> 
  <VAR>time1 time2 -&gt; boolean</VAR>
  <DD class=proc-def>Returns #t if time1 is at or before time2, #f
  otherwise. Must account for time zone offsets.

  <DT class=proc-def><CODE class=proc-def>add-seconds!</CODE> 
  <VAR>time real -&gt; time</VAR>
  <DD class=proc-def>Adds a number of seconds to a time object, side
  effecting it. 

  <DT class=proc-def><CODE class=proc-def>add-seconds</CODE> 
  <VAR>time real -&gt; time</VAR>
  <DD class=proc-def>Adds a number of seconds to a time object,
  creating a new time object.

  <DT class=proc-def><CODE class=proc-def>time-difference</CODE> 
  <VAR>time1 time2 -&gt; real</VAR>
  <DD class=proc-def>Returns the number of seconds difference between
  two times, accounting for time zone offsets.

</DL>

<H1>Implementation</H1>

This SRFI has several implementation dependent requirements; in
particular, there must be some system-independent method of finding
the current time (or current seconds).

<P>The accompanying implementation assumes <a
href="http://srfi.schemers.org/srfi-6/">SRFI 6 Basic String Ports</a>.
The accompanying implementation also assumes an <CODE>error</CODE>
procedure.  The accompanying implementation also assumes <a
href="http://srfi.schemers.org/srfi-6/">SRFI 8 RECEIVE: Binding to
multiple values</a>.  which is easy to implement with the following
syntax:

<CODE>
<PRE>
(define-syntax receive
  (syntax-rules ()
    ((receive formals expression body ...)
     (call-with-values (lambda () expression)
                       (lambda formals body ...)))))
</PRE>
</CODE>


<P>The <a href="http://www.neodesiclabs.com/will/srfi-19.scm">accompanying 
implementation</a> is written in MzScheme. MzScheme provides the procedure 
<CODE>current-seconds</CODE>, which returns the number of seconds
since 1970-01-01T00:00:00Z+00:00. 

<p>Also, MzScheme provides a method for returning the current time
zone offset, via its SECONDS-&gt;DATE and CURRENT-DATE procedures.

<p>From this, the rest of the implementation
was built. 

<h1>Acknowledgements</h1>

Claus
Tøndering's<a href="http://www.tondering.dk/claus/calendar.html"> Frequently Asked Questions</a> about calendars was a very
useful resource. The implementation of Julian Day, Modified Julian
Day, and Year Day comes from his FAQ. Markus Kuhn has a <a
href="http://www.cl.cam.ac.uk/~mgk25/iso-time.html">useful
description</a> of the <a
href="http://www.iso.ch/markete/8601.pdf">ISO Standard 8601</a> for
Date/Time notation; The W3 Consortium also has a <a
href="http://www.w3.org/TR/NOTE-datetime">useful Note</a>.

<p>Mike Sperber, Marc Feely, Dave Mason, and "Prfnoff" all made useful
comments on previous versions of this draft. Thanks to Shriram 
Krishnamurthi for his editing help.

<H1>Copyright</H1>Copyright (C) Neodesic Corporation (2000). All Rights Reserved. 
<P>This document and translations of it may be copied and furnished to others, 
and derivative works that comment on or otherwise explain it or assist in its 
implementation may be prepared, copied, published and distributed, in whole or 
in part, without restriction of any kind, provided that the above copyright 
notice and this paragraph are included on all such copies and derivative works. 
However, this document itself may not be modified in any way, such as by 
removing the copyright notice or references to the Scheme Request For 
Implementation process or editors, except as needed for the purpose of 
developing SRFIs in which case the procedures for copyrights defined in the SRFI 
process must be followed, or as required to translate it into languages other 
than English. 
<P>The limited permissions granted above are perpetual and will not be revoked 
by the authors or their successors or assigns. 
<P>This document and the information contained herein is provided on an "AS IS" 
basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL WARRANTIES, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE 
INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF 
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. 
<HR>

<ADDRESS>Editor: <A href="mailto:srfi-editors@srfi.schemers.org">Shriram 
Krishnamurthi</A></ADDRESS>
Last 
modified <CODE>(display (time-&gt;string (time-&gt;universal-time! (current-time))))</CODE>: 
2000-04-11T14:00:17Z+00:00</BODY></HTML>
